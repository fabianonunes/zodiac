var dust={};
(function(d){function g(a,b,c){this.stack=a;this.global=b;this.blocks=c}function i(a,b,c,f){this.tail=b;this.isObject=!d.isArray(a)&&a&&typeof a==="object";this.head=a;this.index=c;this.of=f}function j(a){this.head=new e(this);this.callback=a;this.out=""}function h(){this.head=new e(this)}function e(a,b,c){this.root=a;this.next=b;this.data="";this.flushable=!1;this.taps=c}function k(a,b){this.head=a;this.tail=b}d.cache={};d.register=function(a,b){a&&(d.cache[a]=b)};d.render=function(a,b,c){c=(new j(c)).head;
d.load(a,c,g.wrap(b)).end()};d.stream=function(a,b){var c=new h;d.nextTick(function(){d.load(a,c.head,g.wrap(b)).end()});return c};d.renderSource=function(a,b,c){return d.compileFn(a)(b,c)};d.compileFn=function(a,b){var c=d.loadSource(d.compile(a,b));return function(a,b){var e=b?new j(b):new h;d.nextTick(function(){c(e.head,g.wrap(a)).end()});return e}};d.load=function(a,b,c){var f=d.cache[a];return f?f(b,c):d.onLoad?b.map(function(b){d.onLoad(a,function(f,e){if(f)return b.setError(f);d.cache[a]||
d.loadSource(d.compile(e,a));d.cache[a](b,c).end()})}):b.setError(Error("Template Not Found: "+a))};d.loadSource=function(a){return eval(a)};d.isArray=Array.isArray?Array.isArray:function(a){return Object.prototype.toString.call(a)=="[object Array]"};d.nextTick=function(a){setTimeout(a,0)};d.isEmpty=function(a){return d.isArray(a)&&!a.length?!0:a===0?!1:!a};d.filter=function(a,b,c){if(c)for(var f=0,e=c.length;f<e;f++){var g=c[f];g==="s"?b=null:a=d.filters[g](a)}b&&(a=d.filters[b](a));return a};d.filters=
{h:function(a){return d.escapeHtml(a)},j:function(a){return d.escapeJs(a)},u:encodeURI,uc:encodeURIComponent};d.makeBase=function(a){return new g(new i,a)};g.wrap=function(a){return a instanceof g?a:new g(new i(a))};g.prototype.get=function(a){for(var b=this.stack,c;b;){if(b.isObject&&(c=b.head[a],c!==void 0))return c;b=b.tail}return this.global?this.global[a]:void 0};g.prototype.getPath=function(a,b){var c=this.stack,d=b.length;if(a&&d===0)return c.head;if(c.isObject){for(var c=c.head,e=0;c&&e<d;)c=
c[b[e]],e++;return c}};g.prototype.push=function(a,b,c){return new g(new i(a,this.stack,b,c),this.global,this.blocks)};g.prototype.rebase=function(a){return new g(new i(a),this.global,this.blocks)};g.prototype.current=function(){return this.stack.head};g.prototype.getBlock=function(a){var b=this.blocks;if(b)for(var c=b.length,d;c--;)if(d=b[c][a])return d};g.prototype.shiftBlocks=function(a){var b=this.blocks;return a?(newBlocks=b?b.concat([a]):[a],new g(this.stack,this.global,newBlocks)):this};j.prototype.flush=
function(){for(var a=this.head;a;){if(a.flushable)this.out+=a.data;else{if(a.error)this.callback(a.error),this.flush=function(){};return}this.head=a=a.next}this.callback(null,this.out)};h.prototype.flush=function(){for(var a=this.head;a;){if(a.flushable)this.emit("data",a.data);else{if(a.error)this.emit("error",a.error),this.flush=function(){};return}this.head=a=a.next}this.emit("end")};h.prototype.emit=function(a,b){var c=this.events;if(c&&c[a])c[a](b)};h.prototype.on=function(a,b){if(!this.events)this.events=
{};this.events[a]=b;return this};e.prototype.write=function(a){var b=this.taps;b&&(a=b.go(a));this.data+=a;return this};e.prototype.end=function(a){a&&this.write(a);this.flushable=!0;this.root.flush();return this};e.prototype.map=function(a){var b=new e(this.root,this.next,this.taps),c=new e(this.root,b,this.taps);this.next=c;this.flushable=!0;a(c);return b};e.prototype.tap=function(a){var b=this.taps;this.taps=b?b.push(a):new k(a);return this};e.prototype.untap=function(){this.taps=this.taps.tail;
return this};e.prototype.render=function(a,b){return a(this,b)};e.prototype.reference=function(a,b,c,f){return typeof a==="function"&&(a=a(this,b,null,{auto:c,filters:f}),a instanceof e)?a:d.isEmpty(a)?this:this.write(d.filter(a,c,f))};e.prototype.section=function(a,b,c,f){if(typeof a==="function"&&(a=a(this,b,c,f),a instanceof e))return a;var g=c.block,c=c["else"];f&&(b=b.push(f));if(d.isArray(a)){if(g){for(var f=a.length,c=this,l=0;l<f;l++)c=g(c,b.push(a[l],l,f));return c}}else if(a===!0){if(g)return g(this,
b)}else if(a||a===0){if(g)return g(this,b.push(a))}else if(c)return c(this,b);return this};e.prototype.exists=function(a,b,c){var f=c.block,c=c["else"];if(d.isEmpty(a)){if(c)return c(this,b)}else if(f)return f(this,b);return this};e.prototype.notexists=function(a,b,c){var f=c.block,c=c["else"];if(d.isEmpty(a)){if(f)return f(this,b)}else if(c)return c(this,b);return this};e.prototype.block=function(a,b,c){c=c.block;a&&(c=a);return c?c(this,b):this};e.prototype.partial=function(a,b){return typeof a===
"function"?this.capture(a,b,function(a,f){d.load(a,f,b).end()}):d.load(a,this,b)};e.prototype.helper=function(a,b,c,f){return d.helpers[a](this,b,c,f)};e.prototype.capture=function(a,b,c){return this.map(function(d){var e=new j(function(a,b){a?d.setError(a):c(b,d)});a(e.head,b).end()})};e.prototype.setError=function(a){this.error=a;this.root.flush();return this};d.helpers={sep:function(a,b,c){return b.stack.index===b.stack.of-1?a:c.block(a,b)},idx:function(a,b,c){return c.block(a,b.push(b.stack.index))}};
k.prototype.push=function(a){return new k(a,this)};k.prototype.go=function(a){for(var b=this;b;)a=b.head(a),b=b.tail;return a};var m=RegExp(/[&<>\"]/),n=/&/g,o=/</g,p=/>/g,q=/\"/g;d.escapeHtml=function(a){return typeof a==="string"?!m.test(a)?a:a.replace(n,"&amp;").replace(o,"&lt;").replace(p,"&gt;").replace(q,"&quot;"):a};var r=/\\/g,s=/\r/g,t=/\u2028/g,u=/\u2029/g,v=/\n/g,w=/\f/g,x=/'/g,y=/"/g,z=/\t/g;d.escapeJs=function(a){return typeof a==="string"?a.replace(r,"\\\\").replace(y,'\\"').replace(x,
"\\'").replace(s,"\\r").replace(t,"\\u2028").replace(u,"\\u2029").replace(v,"\\n").replace(w,"\\f").replace(z,"\\t"):a}})(dust);if(typeof exports!=="undefined")typeof process!=="undefined"&&require("./server")(dust),module.exports=dust;
