function readFile(a,b,c){if(!a)return null;var d=new FileReaderSync,e=d.readAsText(a),f=[];return e.split("\n").forEach(function(a){a=a.trim(),a&&(b?Array.prototype.push.apply(f,a.match(b)):f.push(a))}),f}function sortBy(a,b,c){return a.sort(function(a,c){var d=parseInt(a[b],10),e=parseInt(c[b],10);return d<e?-1:d>e?1:0})}self.BlobBuilder=self.WebKitBlobBuilder||self.MozBlobBuilder;var TextWorker={sort:function(a){var b="",c=0,d=a.map(function(a){return{line:a}});return d=sortBy(d,"line"),d.forEach(function(a){b+=a.line,b+="\n",c+=1}),{lines:b,length:c}},uniq:function(a){var b={},c=0,d="";return a.forEach(function(a){b[a]||(b[a]=!0,d+=a,d+="\n",c+=1)}),{lines:d,length:c}},dups:function(a){var b="",c=0,d={};return a.forEach(function(a){d[a]=+[d[a]]+1}),Object.keys(d).forEach(function(a){d[a]>1&&(b+=a,b+="\n",c+=1)}),{lines:b,length:c}},difference:function(a,b){var c="",d=0,e={};return b.forEach(function(a,b){e[a]=!0}),a.forEach(function(a){e[a]||(c+=a,c+="\n",d+=1)}),{lines:c,length:d}},union:function(a,b){var c=b.concat(a);return{lines:c.join("\n"),length:c.length}},intersection:function(a,b){var c="",d=0,e={};return a.forEach(function(a,b){e[a]=!0}),b.forEach(function(a){e[a]===!0&&(e[a]=!1,c+=a,c+="\n",d+=1)}),{lines:c,length:d}},symmetric:function(a,b){var c="",d=0,e={};return a.forEach(function(a){e[a]=+[e[a]]+1}),b.forEach(function(a){e[a]=+[e[a]]+1}),Object.keys(e).forEach(function(a){e[a]===1&&(c+=a,c+="\n",d+=1)}),{lines:c,length:d}},charge:function(a,b){return{lines:b.join("\n"),length:b.length}},grep:function(a,b){var c="",d=0,e={},f=b.map(function(a){return new RegExp(a,"i")});return a.forEach(function(a){var b;b=a;var e=f.some(function(a){return b!==(b=b.replace(a,"<b>$&</b>"))});e&&(c+=a,c+="\n",d+=1)}),{lines:c,length:d}}};onmessage=function(a){var b=a.data,c=TextWorker[b.op],d=c(readFile(b.previous),readFile(b.file,b.mask));if("undefined"!=typeof self.BlobBuilder){var e=new self.BlobBuilder;e.append(d.lines),d.lines=e.getBlob("text/plain")}postMessage(d)}